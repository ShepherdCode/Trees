\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[margin=.5in]{geometry}
\usepackage{enumitem}

\title{Shepherd Trees}
\author{Emily Foote}
\date{\today}

\begin{document}

\maketitle

\section{Setting Everything Up}
\subsection{MySql Server}
\begin{enumerate}
    \item Installed MySQL community server 8.0.13, username: root, password: shepherd
    \item Setup MySQL client in terminal \begin{verbatim}
$ source ~/.bash_profile
$ echo 'export PATH=$PATH:/usr/local/mysql/bin' >> ~/.bash_profile
$ mysql -u root -p
Enter Password: shepherd
\end{verbatim}
    \item Change the old password hash to read new password: \begin{verbatim}
mysql> ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 
       'shepherd'; 
Query OK, 0 rows affected (0.01 sec)
\end{verbatim}
    \item Now inside the SQL server, check the current databases.
\begin{verbatim}
mysql> SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows in set (0.01 sec)
    \end{verbatim}
    \item  Create a new database called \texttt{sheptrees} and make sure it is created: \begin{verbatim}
mysql> CREATE DATABASE sheptrees; 
Query OK, 1 row affected (0.03 sec)

mysql> SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| sheptrees          |
+--------------------+
5 rows in set (0.00 sec)
\end{verbatim}
    \item  Exit client, change directory to \texttt{Trees/DataFiles}, and run sql script \texttt{trees.sql} into newly created \texttt{sheptrees} database:
\begin{verbatim}
$ mysql -u root -p  sheptrees < trees.sql
Enter password: shepherd
\end{verbatim}
\end{enumerate}
\subsection{PHP Script}
query.php
\begin{verbatim}
<?php
$servername = "127.0.0.1";
$username = "root";
$password = "shepherd";
$dbname = "sheptrees";
$conn = new mysqli($servername, $username, $password, $dbname);
if ($conn -> connect_error) {
  die ("Connection failed: " . $conn -> connect_error);
}
$sql = "SELECT TreeID, ScientificName FROM trees WHERE TreeID = 1;";
$result = $conn -> query($sql);
if ($result -> num_rows > 0) {
  while($row = $result->fetch_assoc()) {
    echo "TreeID: " . $row["TreeID"] . " - Species: " . $row["ScientificName"] . "<br>";}
  } else {
    echo "0 results";
}
$conn -> close();
?>
\end{verbatim}
\subsection{Running the Script}\begin{enumerate}
    \item Make sure MySQL server is up and running
    \item Open terminal, change directory to webpages' location:\begin{verbatim}
$ php -S localhost:8000
PHP 7.1.19 Development Server started at Mon Dec 31 15:55:19 2018
Listening on http://localhost:8000
Document root is /Users/emilyfoote/Documents/College/NASA Fellowship/Trees/WebPages
Press Ctrl-C to quit.
/query.php
\end{verbatim}
    \item Go to web browser, load webpage \texttt{localhost:8000/query.php}.\\
Result: \\
tree\_id: 1 - Species: Acer saccharum

SUCCESS!!!
\end{enumerate}

\section{Normalizing the Database}
\subsection{Genus Table}
\begin{enumerate}
    \item Create the table:\begin{verbatim}
mysql> CREATE TABLE Genus (
    -> genus_id int NOT NULL UNIQUE AUTO_INCREMENT, 
    -> genus_name varchar(255) NOT NULL UNIQUE,
    -> PRIMARY KEY (genus_id)); 
Query OK, 0 rows affected (0.06 sec)
    \end{verbatim}
\item Populate the new table from \texttt{trees}:\begin{verbatim}
mysql> INSERT INTO Genus (genus_name)
    -> SELECT DISTINCT(genus)
    -> FROM trees
    -> ORDER BY genus ASC;
Query OK, 27 rows affected (0.08 sec)
Records: 27  Duplicates: 0  Warnings: 0
\end{verbatim}
\end{enumerate}

\subsection{Species Table}
\begin{enumerate}
    \item Create the table: \begin{verbatim}
mysql> CREATE TABLE Species (
    -> species_id int NOT NULL UNIQUE AUTO_INCREMENT, 
    -> species_name varchar(255),
    -> genus_id int NOT NULL,
    -> PRIMARY KEY (species_id), 
    -> FOREIGN KEY(genus_id) REFERENCES Genus(genus_id)); 
Query OK, 0 rows affected (0.05 sec)
    \end{verbatim}
    \item Populate table: \begin{verbatim}
mysql> INSERT INTO Species (species_name, genus_id) 
    -> SELECT DISTINCT species, Genus.genus_id
    -> FROM trees LEFT JOIN Genus ON trees.genus = Genus.genus_name
    -> ORDER BY species ASC; 
Query OK, 46 rows affected (0.03 sec)
Records: 46  Duplicates: 0  Warnings: 0
    \end{verbatim}
    \end{enumerate}
\subsection{Tree Table}
Not to be confused with the original trees table. \begin{enumerate}
    \item Create the table: \begin{verbatim}
mysql> CREATE TABLE Tree (
    -> tree_id int UNIQUE NOT NULL, 
    -> species_id int,
    -> PRIMARY KEY (tree_id), 
    -> FOREIGN KEY (species_id) REFERENCES Species(species_id)); 
Query OK, 0 rows affected (0.04 sec)
    \end{verbatim}
    \item Populate the table first where the species value is \texttt{NULL}: \begin{verbatim}
mysql> INSERT INTO Tree (tree_id, species_id)
    -> SELECT t.TreeID, s.species_id
    -> FROM trees t, Species s, Genus g
    -> WHERE t.Species IS NULL
    -> AND s.Species_name IS NULL
    -> AND s.genus_id = g.genus_id
    -> AND g.genus_name = t.Genus;
Query OK, 59 rows affected (0.05 sec)
Records: 59  Duplicates: 0  Warnings: 0
    \end{verbatim}
And for when the species value is \texttt{NOT NULL}:\begin{verbatim}
mysql> INSERT INTO Tree (tree_id, species_id)
    -> SELECT t.TreeID, s.species_id
    -> FROM trees t, Species s, Genus g
    -> WHERE t.Species =s.species_name
    -> AND s.genus_id = g.genus_id
    -> AND g.genus_name = t.Genus;
Query OK, 183 rows affected (0.09 sec)
Records: 183  Duplicates: 0  Warnings: 0
\end{verbatim}
\end{enumerate}

\section{Testing Database Queries}
\begin{enumerate}
    \item List all genus+species names in alphabetical order: \begin{verbatim}
mysql> SELECT genus_name, species_name
    -> FROM Genus g, Species s
    -> WHERE g.genus_id = s.genus_id
    -> ORDER BY genus_name, species_name; 
+---------------+---------------+
| genus_name    | species_name  |
+---------------+---------------+
| Abies         | NULL          |
| Acer          | griseum       |
| Acer          | negundo       |
| Acer          | nigrum        |
| Acer          | palmatum      |
| Acer          | rubrum        |
| Acer          | saccharinum   |
| Acer          | saccharum     |
| Amelanchier   | NULL          |
| Betula        | NULL          |
| Betula        | nigra         |
| Betula        | papyrifera    |
| Carpinifolia  | NULL          |
| Carya         | illinoinensis |
| Cedrus        | atlantica     |
| Celtis        | occidentalis  |
| Cercis        | canadensis    |
| Cornus        | NULL          |
| Fraxinus      | NULL          |
| Fraxinus      | americana     |
| Fraxinus      | pennsylvanica |
| Ginkgo        | biloba        |
| Gleditsia     | triacanthos   |
| Juglans       | nigra         |
| Lagerstroemia | NULL          |
| Magnolia      | grandiflora   |
| Magnolia      | soulangeana   |
| Malus         | hopa          |
| Morus         | alba          |
| Picea         | abies         |
| Picea         | rubens        |
| Platanus      | occidentalis  |
| Prunus        | avium         |
| Prunus        | serotinia     |
| Prunus        | subhirtella   |
| Pyrus         | calleryana    |
| Quercus       | coccinea      |
| Quercus       | muehlenbergii |
| Quercus       | phellos       |
| Quercus       | rubra         |
| Quercus       | velutina      |
| Styphnolobium | japonicum     |
| Styrax        | japonicus     |
| Tsuga         | canadensis    |
| Ulmus         | parvifolia    |
| Ulmus         | pumila        |
+---------------+---------------+
46 rows in set (0.00 sec)

    \end{verbatim}
    \item List any genuses for which there is no species:\begin{verbatim}
mysql> SELECT genus_name
    -> FROM Genus g, Species s
    -> WHERE g.genus_id = s.genus_id 
    -> AND s.species_name IS NULL
    -> ORDER BY genus_name ASC; 
+---------------+
| genus_name    |
+---------------+
| Abies         |
| Amelanchier   |
| Betula        |
| Carpinifolia  |
| Cornus        |
| Fraxinus      |
| Lagerstroemia |
+---------------+
7 rows in set (0.00 sec)
    \end{verbatim}
    \item List any species for which there is no tree: \begin{verbatim}
mysql> SELECT species_name
    -> FROM Species s, Tree t
    -> WHERE t.species_id = s.species_id
    -> AND t.species_id IS NULL; 
Empty set (0.00 sec)
    \end{verbatim}
\end{enumerate}

\end{document}
